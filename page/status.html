<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>Status</title>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-13FLHMGH10"></script>
    <script>
      window.dataLayer = window.dataLayer || []
      function gtag() {
        dataLayer.push(arguments)
      }
      gtag('js', new Date())

      gtag('config', 'G-13FLHMGH10')
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-qKXV1j0HvMUeCBQ+QVp7JcfGl760yU08IQ+GpUo5hlbpg51QRiuqHAJz8+BrxE/N"
      crossorigin="anonymous"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp"
      crossorigin="anonymous" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css" />
    <script>
      function competitionColor(value) {
        if (value >= 3) return 'red'
        else if (value >= 2) return 'orange'
        else if (value >= 1) return 'yellow'
        else return 'green'
      }
      async function getRequest() {
        const getResponse = await fetch('/statusData', {
          method: 'get',
        })
        const getJson = await getResponse.json()
        return getJson
      }
      getRequest().then((data) => {
        let tbody_tag = ''
        data['data'].sort((a, b) => b['경쟁률'] - a['경쟁률'])
        let rank = 0
        for (info of data['data']) {
          rank += 1
          competition = parseFloat(info['경쟁률']).toFixed(3)
          tbody_tag += `
          <tr>
            <td nowrap><span style="color: white;">${rank}</span></td>
            <td nowrap><span style="color: #5f6062;">${info['학부(과)']}</span></td>
            <td nowrap><strong><span style="color: white;">${info['강좌명']}</span></strong></td>
            <td nowrap><span style="color: #5f6062;">${info['교수명']}</span></td>
            <td align="right" nowrap><span style="color: white;">${info['제한인원']}</span></td>
            <td align="right" nowrap><span style="color: white;">${info['장바구니']}</span></td>
            <td align="center" nowrap><b><span style="color: ${competitionColor(
              competition,
            )};">${competition}</span></b></td>
          </tr>
          `
        }
        let table_tag = `
        <div class="table-responsive">
          <table class="table table-dark">
            <thead>
              <tr>
                <th scope="col" nowrap>순위</th>
                <th scope="col" nowrap>학부(과)</th>
                <th scope="col" nowrap>강좌명</th>
                <th scope="col" nowrap>교수명</th>
                <th style="text-align: right" scope="col" nowrap>제한인원</th>
                <th style="text-align: right" scope="col" nowrap>장바구니</th>
                <th style="text-align: center" scope="col" nowrap>경쟁률</th>
              </tr>
            </thead>
            <tbody>
              ${tbody_tag}
            </tbody>
          </table>
        </div>
        `
        // document.getElementById('time').innerHTML = data['time'] + ' 에 갱신되었습니다.'
        document.getElementById('info').innerHTML = table_tag
      })
    </script>
  </head>
  <body>
    <div style="padding: 20px 0px 0px 20px">
      <span style="font-size: 1.7rem">
        <img
          src="https://www.syu.ac.kr/wp-content/uploads/2018/05/pg_thum.png"
          width="35px"
          height="auto"
          style="vertical-align: text-bottom" />
        <strong>장바구니 경쟁률 현황</strong>
      </span>
    </div>
    <hr />
    <!-- <div style="padding: 0px 0px 20px 20px">
      <strong>
        <span style="font-size: 1.3rem" id="time"></span>
      </strong>
    </div> -->
    <div style="padding: 0px 0px 20px 20px">
      <div style="font-size: 1.3rem; color: red">
        <strong>※ 장바구니 최종 경쟁률 입니다.</strong>
      </div>
      <div style="font-size: 1.3rem; color: red">
        <strong>※ 본 수강신청에서 경쟁률이 더 높을 수 있습니다.</strong>
      </div>
      <div>(검색 도구를 활용하여 과목을 확인할 수 있습니다.)</div>
      <div>(표가 짤린 경우 옆으로 드래그 하면 확인할 수 있습니다.)</div>
    </div>
    <span id="info"></span>
  </body>
</html>
